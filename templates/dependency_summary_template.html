import pandas as pd
from jinja2 import Environment, FileSystemLoader

# Load your CSV
df = pd.read_csv("docs/jira_data.csv")

# Handle missing fields
df["Summary"] = df["Summary"].fillna("N/A")
df["Status"] = df["Status"].fillna("N/A")
df["Components"] = df["Components"].fillna("Unknown")

# Organize data by team
team_dependencies = {}
for _, row in df.iterrows():
    team = row["Components"]
    if team not in team_dependencies:
        team_dependencies[team] = []
    team_dependencies[team].append({
        "key": row["Issue key"],
        "summary": row["Summary"],
        "status": row["Status"]
    })

# Set up Jinja2
env = Environment(loader=FileSystemLoader("templates"))
template = env.get_template("dependency_summary_template.html")

# Render and write HTML
html = template.render(dependencies=team_dependencies, jira_domain="evolve24.atlassian.net")

with open("docs/dependency_summary.html", "w") as f:
    f.write(html)

print("âœ… dependency_summary.html has been generated.")

